---
title: ResNet50 을 활용한 돼지 도체의 성별 예측
author: Hyo-Jun Lee
date: 2021-03-02 17:00:00 +0900
categories: [Computer-Vision]
tags: [Computer-Vision, Animal-Science]
math: true
---

<small>사용된 코드는 아래의 url 에서 확인 하실 수 있습니다. The codes used in the poster can be found at **https://github.com/gywns6287/pig_sex_classifier**
</small>

이번 글에서는 컴퓨터 비전 영역의 성공한 딥러닝 모델인 ResNet50 를 활용하여 돼지 도체의 성별을 예측하는 모델을 구현해 보고자 합니다.

## ResNet50

### Skip connection
ResNet 은 ImageNet 영상 인식 대회에 2015년에 승리를 한 네트워크로 현재 많은 CNN 모델의 트렌드를 만든 모델이다. ResNet의 핵심 요소는 바로 스킵 연결 (skip connection) 이다. 숏컷 연결 (shortcut connection) 이라고도 불리는 이 기법은 말 그대로 특정 층에 존재하는 출력물을 다음 합성곱 층을 통과한 출력물에 더해주는 연결을 뜻 한다. 

![image](https://user-images.githubusercontent.com/71325306/109637429-215a3880-7b90-11eb-9014-3a8fdbbe299b.png)

일반적인 신경망을 훈련시킬 때는 목적 함수 $$h(x)$$ 를 모델링 하는 것을 목표로 하게 된다. 하지만, 네트워크의 출력이 입력 부분과 더해지게 된다면 네트워크는 $$h(x)$$ 를 학습 하는 대신 $$f(x)=h(x)-x$$ 를 학습하게 될 것이다. 다시 생각해보면 이 $$f(x)$$는 바로 모델 $$h(x)$$ 의 잔차(residual) 라고도 볼 수 있다. 이것이 바로 이 네트워크가 Res(residual) Net 이라고 불리는 이유라고 할 수 있다.

### Model architecture

![image](https://user-images.githubusercontent.com/71325306/109637656-6d0ce200-7b90-11eb-90ef-8a89fea13aea.png)

위의 그림은 ResNet의 구조에 대한 간략한 모식도 이다. ResNet의 잔차블록은 채널의 개수를 줄여주는 첫번째 층 (합성곱 1x1) 이후 합성 곱 연산을 담당해주는 두번째 층 (합성곱 3x3) 마지막으로 채널의 개수를 다시 늘려주는 층 (합성곱 1x1) 총 세개의 층으로 병목(bottle neck) 구조로 구현되어 있다. ResNet 은 이러한 잔차 블록을 얼마나 쌓는가에 따라 ResNet36, ResNet50, ResNet101 층 등 다양한 형태를 취할 수 있다.

## Class activation map

딥 러닝의 가장 큰 단점 중 하나는 바로 모델이 영상으로부터 의사 결정을 하게 된 원인을 파악하기 힘들다는 점이다. Bolei et al 은 이러한 문제점을 해결하기 위해 Class activation map(CAM) 을 제시하였다.

![image](https://user-images.githubusercontent.com/71325306/109638768-c295be80-7b91-11eb-8d3a-02b701e937d7.png)

위의 그림은 CAM의 원리를 보여주고 있다. 딥 러닝 모델의 마지막 출력 부문을 GAP(Global Average Pooling)으로 변환 시켜 주어 마지막 합성 곱 층에서 출력되는 feature channel 들의 weight를  학습과정에서 모델이 계산할 수 있게 해준다. 후에 계산된 weights와 마지막 합성 곱 층의 출력 feature channel 들을 곱한 후 모두 더해주면 모델이 의사결정을 하게 된 요인을 파악하기 위한 Class activation map을 얻을 수 있게 된다.

## Pig sex estimation

돼지의 성별은 돼지고기의 가격을 결정하게 되는 주요한 요인이다. 현재 돼지의 성별은 돼지의 도축 과정 중 숙련된 판 정사에 의해 판정되고 있다. 하지만 사람이 일일이 모든 돼지고기를 판정 하는 것은 생산과정에서 많은 시간과 인력을 요구하게 된다. 이에 돼지고기 생성 공정에 인공지능을 활용한 자동 돼지 성별 판독기를 도입한다면, 더 효율적인 돼지고기 생산이 가능해질 것이다.

### Implementation